library(sf)
library(tidyverse)
lanes <- st_read("tow_lanes.kml")
library(here)
set_here(path='..')
lanes <- st_read(here("data", "tow_lanes.kml"))
library(here)
library(sf)
library(tidyverse)
#info
# vessel type code 52 is for tug boats, 31 and 32 for tow
# (https://api.vtexplorer.com/docs/ref-aistypes.html)
#load data
lanes <- st_read(here("data", "tow_lanes.kml")) %>%
st_make_valid()
View(lanes)
library(here)
library(sf)
library(tidyverse)
#load data
lanes <- st_read(here("data", "Towlanes_WASG_2007", "Towlanes_WASG_2007.shp")) %>%
st_make_valid()
#load data
lanes <- st_read(here("data", "Towlanes_WASG_2007", "Towlanes_WASG_2007.shp")) %>%
st_make_valid()
#coos bay
coosBay <- data.frame(longitude = -124.217888, latitude = 43.366501) %>%
st_as_sf(., coords = c('longitude', 'latitude'), crs = 4326)
#plot data
ggplot() +
geom_sf(data = lanes, fill = "transparent") +
geom_sf(data = coast) +
geom_sf(data = coosBay, color = "red") +
coord_sf(xlim = c(-124.217888 - 1, -124.217888 + 1),
ylim = c(43.366501 - 1, 43.366501 + 1)) +
theme_bw() +
theme(legend.position = "none")
#plot data
ggplot() +
geom_sf(data = lanes, fill = "transparent") +
geom_sf(data = coosBay, color = "red") +
coord_sf(xlim = c(-124.217888 - 1, -124.217888 + 1),
ylim = c(43.366501 - 1, 43.366501 + 1)) +
theme_bw() +
theme(legend.position = "none")
#plot data
ggplot() +
geom_sf(data = lanes, fill = "transparent") +
theme_bw() +
theme(legend.position = "none")
coast <- st_read(here("data", "us_medium_shoreline",
"us_medium_shoreline.shp"))
#plot data
leaflet(lanes) %>%
addTiles()
library(leaflet)
#plot data
leaflet(lanes) %>%
addTiles()
??addPolygons
??leaflet::addPolygons
st_crs(lanes)
class(lanes)
leaflet(lanes) %>%
addTiles() %>%
addPolygons()
lanes <- st_read(here("data", "Towlanes_WASG_2007", "Towlanes_WASG_2007.shp")) %>%
st_make_valid() %>%
st_transform(crs = 4326)
#plot data
leaflet(lanes) %>%
addTiles() %>%
addPolygons()
#load data
lanes <- st_read(here("data", "Towlanes_WASG_2007", "Towlanes_WASG_2007.shp")) %>%
st_make_valid() %>%
st_transform(crs = 4326)
#plot data
lanes_map <- leaflet(lanes) %>%
addTiles() %>%
addPolygons()
saveWidget(lanes_map, file = here("output", "choro_imap.html"))
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- st_read(here("data", "Towlanes_WASG_2007",
"Towlanes_WASG_2007.shp")) %>%
st_make_valid() %>%
st_transform(crs = 4326)
#plot data
lanes_map <- leaflet(lanes) %>%
addTiles() %>%
addPolygons()
saveWidget(lanes_map, file = here("output", "lanes_map.html"))
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
dat <- read_csv(here("data", "Towlane_all_ordered.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"), crs = 4326)
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
towlane_order_2019 <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y,
popup = ~line)
towlane_order_2019
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
dat <- read_csv(here("data", "Towlane_all_jk.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"), crs = 4326)
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
towlane_order_2019 <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y,
popup = ~line)
towlane_order_2019
names(dat)
#process points -> polygons
lines <- dat %>%
group_by(line) %>%
arrange(order) %>%
summarize(m = mean(X)) %>%
st_cast("LINESTRING")
leaflet(lines) %>%
addTiles() %>%
addPolylines()
leaflet(lines) %>%
addTiles() %>%
addPolylines() %>%
addCircleMarkers(dat, lng = ~X, lat = ~Y,
popup = ~line_order_comb)
??addCircleMarkers
leaflet() %>%
addTiles() %>%
addPolylines(lines) %>%
addCircleMarkers(dat, lng = ~X, lat = ~Y,
popup = ~line_order_comb)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
popup = ~line_order_comb)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.25, popup = ~line_order_comb)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, popup = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.25, popup = ~order)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, popup = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, popup = ~order)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
lines <- dat %>%
group_by(line) %>%
summarize(m = mean(X)) %>%
st_cast("LINESTRING")
#inspect
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
#process points -> polygons
lines <- dat %>%
group_by(line) %>%
summarize(m = mean(X), do_union=FALSE) %>%
st_cast("LINESTRING")
#inspect
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
#inspect
leaflet() %>%
addTiles() %>%
addPolylines(data = lines %>% filter(line == "y_1_"), label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
unique(dat$line)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines %>% filter(line == "y_2_"), label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
lines %>% filter(line == "y_2_")
dat %>% filter(line == "y_2_")
library(here)
library(sf)
library(tidyverse)
#info
# vessel type code 52 is for tug boats, 31 and 32 for tow
# (https://api.vtexplorer.com/docs/ref-aistypes.html)
#load data
lanes <- st_read(here("data", "tow_lanes.kml")) %>%
st_make_valid()
ais <- read_csv(here("data", "large_data", "AIS_2021_03_15.csv"))
ais <- read_csv(here("data", "large_data", "AIS_2021_03_15.csv"))
coast <- st_read(here("data", "us_medium_shoreline",
"us_medium_shoreline.shp"))
#coos bay
coosBay <- data.frame(longitude = -124.217888, latitude = 43.366501) %>%
st_as_sf(., coords = c('longitude', 'latitude'), crs = 4326)
buffer <- st_buffer(coosBay, dist = 1e5)
#clean data
tugTow <- ais %>%
filter(VesselType %in% c(52, 31, 32)) %>%
st_as_sf(.,
coords = c('LON', 'LAT'),
crs = 4326) %>%
st_intersection(., buffer)
coast <- st_transform(coast, crs = st_crs(buffer)) %>%
st_intersection(., buffer)
ggplot() +
geom_sf(data = tugTow, aes(color = VesselName)) +
geom_sf(data = lanes, fill = "transparent") +
geom_sf(data = coast) +
geom_sf(data = coosBay, color = "red") +
coord_sf(xlim = c(-124.217888 - 1, -124.217888 + 1),
ylim = c(43.366501 - 1, 43.366501 + 1)) +
theme_bw() +
theme(legend.position = "none")
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- st_read(here("data", "Towlanes_WASG_2007",
"Towlanes_WASG_2007.shp")) %>%
st_make_valid() %>%
st_transform(crs = 4326)
#plot data
lanes_map <- leaflet(lanes) %>%
addTiles() %>%
addPolygons()
View(lanes_map)
View(lanes)
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
dat <- read_csv(here("data", "Towlane_all_jk.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"), crs = 4326)
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
#inspect
leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y,
popup = ~line)
#process points -> polygons
lines <- dat %>%
group_by(line) %>%
summarize(m = mean(X), do_union=FALSE) %>%
st_cast("LINESTRING")
#inspect
leaflet() %>%
addTiles() %>%
addPolylines(data = lines, label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
leaflet() %>%
addTiles() %>%
addPolylines(data = lines %>% filter(line == "y_2_"), label = ~line) %>%
addCircleMarkers(data = dat, lng = ~X, lat = ~Y,
radius = 0.5, label = ~order)
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
dat <- read_csv(here("data", "Towlane_all.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"), crs = 4326)
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
ggplot() +
geom_sf(data = dat) +
theme_bw()
tow_lanes_all <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y)
saveWidget(tow_lanes_all, file = here("output", "tow_lanes_all.html"))
line <- dat %>% slice(1 : 5) %>% summarize(m = mean(lat_s)) %>% st_cast("LINESTRING")
View(line)
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- read_csv(here("data","towlane_order_2019.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"),crs = 4326) %>% st_make_valid()
dat <- lanes[lanes$type=="Year-round",]
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
View(dat)
polys <- dat %>% group_by(line) %>% summarize(m = mean(order)) %>% st_cast("LINESTRING")
View(polys)
#plot data
lanes_map <- leaflet(polys) %>%
addTiles() %>%
addPolygons()
saveWidget(lanes_map, file = here("output", "yearround_lanes_map.html"))
df <- dat %>% group_by(line) %>% lapply(grp, st_cast("LINESTRING"))
df <- dat %>% group_by(line) %>% lapply(., st_cast("LINESTRING"))
dat %>% group_by(line)
dat %>% group_by(line,order)
dat %>% group_by(line,order) %>% summarize(m = mean(order)) %>% st_cast("LINESTRING")
group_keys(dat)
dat
dat.group_keys
dat %>% group_keys()
dat %>% group_map(line)
dat %>% group_map(line,st_cast("LINESTRING"))
dat %>% group_by(line) %>% group_map(.,st_cast("LINESTRING"))
dat %>% group_by(line) %>% group_keys()
dat %>% group_by(line,order) %>% group_keys()
df <- dat[c(18,9,10,11,12),]
View(df)
df <- dat[,c(18,9,10,11,12)]
df <- subset(dat,select=c(type, line, order, X, Y, geometry))
polys <- df %>% group_by(line) %>% summarize() %>% st_cast("LINESTRING")
View(dat)
View(df)
polys <- df %>% group_by(line) %>% summarize()
df %>% group_by(line)
dat %>% slice(1 : 5) %>% summarize(m = mean(lat_s)) %>% st_cast("LINESTRING")
dat %>% slice(1 : 5) %>% summarize(m = mean(order)) %>% st_cast("LINESTRING")
line <- dat %>% slice(1 : 5) %>% summarize(m = mean(order)) %>% st_cast("LINESTRING")
View(line)
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
dat <- read_csv(here("data", "Towlane_all.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"), crs = 4326)
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
ggplot() +
geom_sf(data = dat) +
theme_bw()
tow_lanes_all <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y)
saveWidget(tow_lanes_all, file = here("output", "tow_lanes_all.html"))
line <- dat %>% slice(1 : 5) %>% summarize(m = mean(lat_s)) %>% st_cast("LINESTRING")
ggplot() +
geom_sf(data = dat %>% slice(1 : 5), color = "grey") +
geom_sf(data = line, color = "blue") +
geom_text(data = dat %>% slice(1 : 5),
aes(x = X, y = Y, label = label)) +
coord_sf(xlim = c(-125.3, -124), ylim = c(46.925, 48.32778)) +
theme_bw()
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- read_csv(here("data","towlane_order_2019.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"),crs = 4326) %>% st_make_valid()
dat <- lanes[lanes$type=="Year-round",]
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
#df <- dat[c(18,9,10,11,12),]
polys <- dat %>% group_by(line) %>% summarize(do_union=FALSE) %>% st_cast("LINESTRING")
View(polys)
#plot data
lanes_map <- leaflet(polys) %>%
addTiles() %>%
addPolygons()
saveWidget(lanes_map, file = here("output", "yearround_lanes_map.html"))
View(lanes_map)
View(lanes)
tow_lanes_all <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y,label=~label)
saveWidget(tow_lanes_all, file = here("output", "tow_lanes_yearround.html"))
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- read_csv(here("data","Towlane_all_jk_ln")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"),crs = 4326) %>% st_make_valid()
lanes <- read_csv(here("data",".csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"),crs = 4326) %>% st_make_valid()
library(here)
library(sf)
library(tidyverse)
library(leaflet)
library(htmlwidgets) #save maps as .html files
#load data
lanes <- read_csv(here("data","Towlane_all_jk_ln.csv")) %>%
st_as_sf(., coords = c("long_dd", "lat_dd"),crs = 4326) %>% st_make_valid()
dat <- lanes[lanes$type=="Year-round",]
dat <- cbind(dat, st_coordinates(dat %>% select(geometry)))
tow_lanes_all <- leaflet(dat) %>%
addTiles() %>%
addCircleMarkers(lng = ~X, lat = ~Y,label=~label)
saveWidget(tow_lanes_all, file = here("output", "tow_lanes_yearround.html"))
polys <- dat %>% group_by(line) %>% summarize(do_union=FALSE) %>% st_cast("LINESTRING")
lanes_map <- leaflet(polys) %>%
addTiles() %>%
addPolygons()
saveWidget(lanes_map, file = here("output", "yearround_lanes_map.html"))
View(polys)
ggplot() +
geom_sf(data = dat, color = "grey") +
geom_sf(data = polys, color = "blue") +
geom_text(data = dat,
aes(x = X, y = Y, label = label)) +
theme_bw()
ggplot() +
geom_sf(data = dat, color = "grey") +
geom_sf(data = polys, color = "blue") +
geom_text(data = dat,
aes(x = X, y = Y)) +
coord_sf(xlim = c(-125.3, -124), ylim = c(46.925, 48.32778)) +
theme_bw()
ggplot() +
geom_sf(data = dat, color = "grey") +
geom_sf(data = polys, color = "blue") +
geom_text(data = dat,
aes(x = X, y = Y,label=FALSE)) +
coord_sf(xlim = c(-125.3, -124), ylim = c(46.925, 48.32778)) +
theme_bw()
ggplot() +
geom_sf(data = dat, color = "grey") +
geom_sf(data = polys, color = "blue") +
geom_text(data = dat,
aes(x = X, y = Y,label="")) +
coord_sf(xlim = c(-125.3, -124), ylim = c(46.925, 48.32778)) +
theme_bw()
#plot polys
lanes_map <- leaflet(polys) %>%
addTiles() %>%
addPolylines()
saveWidget(lanes_map, file = here("output", "yearround_lanes_map.html"))
ggplot() +
geom_sf(data = dat, color = "grey") +
geom_sf(data = polys, color = "blue") +
geom_text(data = dat,
aes(x = X, y = Y,label="")) +
coord_sf(xlim = c(-125.3, -124), ylim = c(41.5, 44)) +
theme_bw()
